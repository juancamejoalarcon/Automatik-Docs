(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{pU93:function(t,e,o){"use strict";o.r(e),o.d(e,"SettingsModule",(function(){return C}));var s=o("ofXK"),r=o("M0ag"),n=o("tyNb"),i=o("ey9i"),a=o("IzEk"),c=o("fXoL"),l=o("3Pt+"),u=o("5eHb"),b=o("p8ln");const d=["modal"],g=["imageSrc"];function m(t,e){if(1&t){const t=c.Rb();c.Qb(0,"input",42),c.Zb("ngModelChange",(function(e){return c.rc(t),c.dc().oldPass=e})),c.Pb()}if(2&t){const t=c.dc();c.ic("ngModel",t.oldPass)}}function p(t,e){if(1&t){const t=c.Rb();c.Qb(0,"input",43),c.Zb("ngModelChange",(function(e){return c.rc(t),c.dc().newPass=e})),c.Pb()}if(2&t){const t=c.dc();c.ic("ngModel",t.newPass)}}function h(t,e){if(1&t){const t=c.Rb();c.Qb(0,"input",44),c.Zb("ngModelChange",(function(e){return c.rc(t),c.dc().removeAccountPass=e})),c.Pb()}if(2&t){const t=c.dc();c.ic("ngModel",t.removeAccountPass)}}function f(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",41),c.Zb("click",(function(){c.rc(t);const e=c.dc();return e.changePassword(e.oldPass.value,e.newPass.value)})),c.zc(1,"Guardar"),c.Pb()}}function _(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",41),c.Zb("click",(function(){c.rc(t);const e=c.dc();return e.removeAccount(e.removeAccountPass)})),c.zc(1,"Eliminar"),c.Pb()}}const v=[{path:"",component:(()=>{class t{constructor(t,e,o,s){this.router=t,this.userService=e,this.fb=o,this.toastr=s,this.user=new i.q,this.errors={},this.isSubmitting=!1,this.settingsForm=this.fb.group({image:"",username:"",email:"",description:"",nameAndSurname:"",contactInformation:"",dateOfBirth:"",companyName:""})}ngOnInit(){console.log("---------MIS HUEVOS---------"),this.userService.isAuthenticated.pipe(Object(a.a)(1))&&(this.router.navigate(["/auth/login"]),Object.assign(this.user,this.userService.getCurrentUser()),this.settingsForm.patchValue(this.user))}onFileChange(t){const e=new FileReader;if(t.target.files&&t.target.files.length){const[o]=t.target.files,s=o.size/1024/1024;this.hasExtension(t.target.value,[".jpg",".gif",".png"])?s>1?(t.target.value="",this.toastr.error("File is bigger than 1 MB","Error",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"})):(e.readAsDataURL(o),e.onload=o=>{var s=new Image;s.src=o.target.result,s.onload=()=>{s.height===s.width?(this.settingsForm.patchValue({image:e.result}),this.imageSrc.nativeElement.src=e.result):(t.target.value="",this.toastr.error("Size error width and height must be equal","Error",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}))}}):(t.target.value="",this.toastr.error("File must be of type jpg gif or png","Error",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}))}}hasExtension(t,e){return new RegExp("("+e.join("|").replace(/\./g,"\\.")+")$").test(t)}submitForm(){this.isSubmitting=!0;const t=this.validation(this.settingsForm.value);console.log(t),this.userService.update(t).subscribe(t=>{this.toastr.success("User updated","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"})},t=>{this.errors=t,this.isSubmitting=!1})}validation(t){const e={},o=Object.entries(t);for(const[s,r]of o)t[s]!==this.user[s]&&(e[s]=r,this.user[s]=r);return e}toggleModal(t=""){this.modalStatus=t,this.modal.nativeElement.classList.toggle("show-modal")}changePassword(t,e){t===e?this.toastr.error("Old and new password are the same","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}):""===t||""===e?this.toastr.error("Fields cannot be empty","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}):this.userService.changePassword({oldPassword:t,newPassword:e}).subscribe(t=>{t.invalidPassword?this.toastr.error("Current password is wrong","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}):(this.toggleModal(),this.toastr.success("User updated","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}))},t=>{this.errors=t,this.isSubmitting=!1})}removeAccount(t){confirm("\xbfSeguro que deseas eliminar tu usuario? Una vez eliminado no habr\xe1 posibilidad de recuperarlo, as\xed como tampoco podr\xe1s recuperar ninguno de los documentos creados con este usuario")&&this.userService.removeAccount(t).subscribe(t=>{t.invalidPassword?this.toastr.error("Contrase\xf1a incorrecta","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}):t.userRemoved&&(this.toastr.success("Usuario eliminado","",{positionClass:"toast-bottom-right",progressBar:!0,progressAnimation:"decreasing"}),this.logout())},t=>{this.errors=t,this.isSubmitting=!1})}logout(){this.userService.purgeAuth(),this.router.navigateByUrl("/")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(n.d),c.Lb(i.r),c.Lb(l.f),c.Lb(u.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["app-settings"]],viewQuery:function(t,e){var o;1&t&&(c.Dc(d,!0),c.Dc(g,!0)),2&t&&(c.oc(o=c.ac())&&(e.modal=o.first),c.oc(o=c.ac())&&(e.imageSrc=o.first))},decls:52,vars:9,consts:[[1,"sub-menu"],[1,"sub-menu__container"],[1,"sub-menu__nav","sub-menu__nav--my-forms",2,"justify-content","center"],[1,"sub-menu__nav__button","sub-menu__nav__button--without-hover"],[1,"settings"],[3,"errors"],[1,"settings__container",3,"formGroup","ngSubmit"],[1,"settings__profile-image"],[1,"settings__profile-image__container"],[1,"settings__profile__image__img"],["alt","profile image",3,"src"],["imageSrc",""],[1,"settings__profile__image__input"],[1,"input-file"],["type","file","name","profile-image",3,"change"],[1,"settings__form"],[1,"settings__form__container"],[1,"settings__form__group"],["type","text","placeholder","Nombre de usuario","formControlName","username"],["type","text","placeholder","Nombre y apellidos","formControlName","nameAndSurname"],["type","text","placeholder","Corren electr\xf3nico","formControlName","email"],["name","description","cols","30","rows","10","placeholder","Description","formControlName","description"],["type","date","placeholder","Fecha de nacimiento","formControlName","dateOfBirth"],["type","text","placeholder","Empresa","formControlName","companyName"],["type","text","placeholder","Contacto","formControlName","contactInformation"],[1,"settings__form__button-container"],["type","submit",1,"button-filled","icon","icon-save-solid"],[1,"settings__buttons"],[1,"settings__buttons__container"],["type","button",1,"button-filled","trigger",3,"click"],["type","button",1,"button-filled",3,"click"],[1,"modal"],["modal",""],[1,"modal__content",2,"padding","2rem"],[1,"modal__content__modal-middle","modal__content__modal-middle--change-password"],[1,"modal__content__modal-middle__container"],["type","password","placeholder","Contrase\xf1a actual",3,"ngModel","ngModelChange",4,"ngIf"],["type","password","placeholder","Contrase\xf1a nueva",3,"ngModel","ngModelChange",4,"ngIf"],["type","password","placeholder","Contrase\xf1a",3,"ngModel","ngModelChange",4,"ngIf"],[1,"modal__content__modal-bottom"],["class","button-filled","id","modal-button",3,"click",4,"ngIf"],["id","modal-button",1,"button-filled",3,"click"],["type","password","placeholder","Contrase\xf1a actual",3,"ngModel","ngModelChange"],["type","password","placeholder","Contrase\xf1a nueva",3,"ngModel","ngModelChange"],["type","password","placeholder","Contrase\xf1a",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"ul",2),c.Qb(3,"li",3),c.zc(4),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(5,"div",4),c.Mb(6,"app-list-errors",5),c.Qb(7,"form",6),c.Zb("ngSubmit",(function(){return e.submitForm()})),c.Qb(8,"div",7),c.Qb(9,"div",8),c.Qb(10,"div",9),c.Mb(11,"img",10,11),c.Pb(),c.Qb(13,"fieldset",12),c.Qb(14,"label",13),c.zc(15," Cambiar imagen de perfil "),c.Qb(16,"input",14),c.Zb("change",(function(t){return e.onFileChange(t)})),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(17,"div",15),c.Qb(18,"div",16),c.Qb(19,"fieldset",17),c.Mb(20,"input",18),c.Mb(21,"input",19),c.Mb(22,"input",20),c.Pb(),c.Qb(23,"fieldset",17),c.Mb(24,"textarea",21),c.Mb(25,"input",22),c.Mb(26,"input",23),c.Mb(27,"input",24),c.Pb(),c.Qb(28,"div",25),c.Mb(29,"button",26),c.Pb(),c.Pb(),c.Pb(),c.Mb(30,"hr"),c.Qb(31,"div",27),c.Qb(32,"div",28),c.Qb(33,"button",29),c.Zb("click",(function(){return e.toggleModal("changePass")})),c.zc(34," Cambiar contrase\xf1a "),c.Pb(),c.Qb(35,"button",30),c.Zb("click",(function(){return e.logout()})),c.zc(36," Cerrar sesi\xf3n "),c.Pb(),c.Qb(37,"button",30),c.Zb("click",(function(){return e.toggleModal("remove")})),c.zc(38," Eliminar cuenta "),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(39,"div",31,32),c.Qb(41,"div",33),c.Qb(42,"div",34),c.Qb(43,"div",35),c.yc(44,m,1,1,"input",36),c.yc(45,p,1,1,"input",37),c.yc(46,h,1,1,"input",38),c.Pb(),c.Pb(),c.Qb(47,"div",39),c.yc(48,f,2,0,"button",40),c.yc(49,_,2,0,"button",40),c.Qb(50,"button",41),c.Zb("click",(function(){return e.toggleModal()})),c.zc(51,"Cancelar"),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.zb(4),c.Bc(" ",e.user.username," "),c.zb(2),c.ic("errors",e.errors),c.zb(1),c.ic("formGroup",e.settingsForm),c.zb(4),c.jc("src",e.user.image,c.tc),c.zb(33),c.ic("ngIf","changePass"===e.modalStatus),c.zb(1),c.ic("ngIf","changePass"===e.modalStatus),c.zb(1),c.ic("ngIf","remove"===e.modalStatus),c.zb(2),c.ic("ngIf","changePass"===e.modalStatus),c.zb(1),c.ic("ngIf","remove"===e.modalStatus))},directives:[b.a,l.G,l.r,l.j,l.c,l.q,l.i,s.t,l.t],encapsulation:2}),t})(),canActivate:[i.a]}];let P=(()=>{class t{}return t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({factory:function(e){return new(e||t)},imports:[[n.h.forChild(v)],n.h]}),t})(),C=(()=>{class t{}return t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({factory:function(e){return new(e||t)},imports:[[s.c,r.a,P]]}),t})()}}]);