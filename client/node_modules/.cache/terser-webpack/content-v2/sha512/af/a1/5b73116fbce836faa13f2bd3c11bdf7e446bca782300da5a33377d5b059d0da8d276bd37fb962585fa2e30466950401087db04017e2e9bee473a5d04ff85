{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{pU93:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,\"SettingsModule\",(function(){return settings_module_SettingsModule}));var common=__webpack_require__(\"ofXK\"),shared=__webpack_require__(\"M0ag\"),fesm2015_router=__webpack_require__(\"tyNb\"),core=__webpack_require__(\"ey9i\"),fesm2015_core=__webpack_require__(\"fXoL\"),fesm2015_forms=__webpack_require__(\"3Pt+\"),ngx_toastr=__webpack_require__(\"5eHb\"),list_errors_component=__webpack_require__(\"p8ln\");const _c0=[\"modal\"],_c1=[\"imageSrc\"];function SettingsComponent_input_44_Template(rf,ctx){if(1&rf){const _r754=fesm2015_core.Rb();fesm2015_core.Qb(0,\"input\",42),fesm2015_core.Zb(\"ngModelChange\",(function($event){return fesm2015_core.rc(_r754),fesm2015_core.dc().oldPass=$event})),fesm2015_core.Pb()}if(2&rf){const ctx_r748=fesm2015_core.dc();fesm2015_core.ic(\"ngModel\",ctx_r748.oldPass)}}function SettingsComponent_input_45_Template(rf,ctx){if(1&rf){const _r756=fesm2015_core.Rb();fesm2015_core.Qb(0,\"input\",43),fesm2015_core.Zb(\"ngModelChange\",(function($event){return fesm2015_core.rc(_r756),fesm2015_core.dc().newPass=$event})),fesm2015_core.Pb()}if(2&rf){const ctx_r749=fesm2015_core.dc();fesm2015_core.ic(\"ngModel\",ctx_r749.newPass)}}function SettingsComponent_input_46_Template(rf,ctx){if(1&rf){const _r758=fesm2015_core.Rb();fesm2015_core.Qb(0,\"input\",44),fesm2015_core.Zb(\"ngModelChange\",(function($event){return fesm2015_core.rc(_r758),fesm2015_core.dc().removeAccountPass=$event})),fesm2015_core.Pb()}if(2&rf){const ctx_r750=fesm2015_core.dc();fesm2015_core.ic(\"ngModel\",ctx_r750.removeAccountPass)}}function SettingsComponent_button_48_Template(rf,ctx){if(1&rf){const _r760=fesm2015_core.Rb();fesm2015_core.Qb(0,\"button\",41),fesm2015_core.Zb(\"click\",(function(){fesm2015_core.rc(_r760);const ctx_r759=fesm2015_core.dc();return ctx_r759.changePassword(ctx_r759.oldPass.value,ctx_r759.newPass.value)})),fesm2015_core.zc(1,\"Guardar\"),fesm2015_core.Pb()}}function SettingsComponent_button_49_Template(rf,ctx){if(1&rf){const _r762=fesm2015_core.Rb();fesm2015_core.Qb(0,\"button\",41),fesm2015_core.Zb(\"click\",(function(){fesm2015_core.rc(_r762);const ctx_r761=fesm2015_core.dc();return ctx_r761.removeAccount(ctx_r761.removeAccountPass)})),fesm2015_core.zc(1,\"Eliminar\"),fesm2015_core.Pb()}}let settings_component_SettingsComponent=(()=>{class SettingsComponent{constructor(router,route,userService,fb,toastr,commonsService){this.router=router,this.route=route,this.userService=userService,this.fb=fb,this.toastr=toastr,this.commonsService=commonsService,this.user=new core.q,this.errors={},this.isSubmitting=!1,this.settingsForm=this.fb.group({image:\"\",username:\"\",email:\"\",description:\"\",nameAndSurname:\"\",contactInformation:\"\",dateOfBirth:\"\",companyName:\"\"})}ngOnInit(){this.route.snapshot.data.initedInServer?(this.userService.isAuthenticated.subscribe(isAuthenticated=>{this.initialValue()}),console.log(\"INITED IN SERVER\")):(console.log(\"INITED IN BROWSER\"),this.initialValue())}initialValue(){Object.assign(this.user,this.userService.getCurrentUser()),this.settingsForm.patchValue(this.user)}onFileChange(event){const reader=new FileReader;if(event.target.files&&event.target.files.length){const[file]=event.target.files,fileSize=file.size/1024/1024;this.hasExtension(event.target.value,[\".jpg\",\".gif\",\".png\"])?fileSize>1?(event.target.value=\"\",this.toastr.error(\"File is bigger than 1 MB\",\"Error\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"})):(reader.readAsDataURL(file),reader.onload=e=>{var image=new Image;image.src=e.target.result,image.onload=()=>{image.height===image.width?(this.settingsForm.patchValue({image:reader.result}),this.imageSrc.nativeElement.src=reader.result):(event.target.value=\"\",this.toastr.error(\"Size error width and height must be equal\",\"Error\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}))}}):(event.target.value=\"\",this.toastr.error(\"File must be of type jpg gif or png\",\"Error\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}))}}hasExtension(element,exts){return new RegExp(\"(\"+exts.join(\"|\").replace(/\\./g,\"\\\\.\")+\")$\").test(element)}submitForm(){this.isSubmitting=!0;const updatedUser=this.validation(this.settingsForm.value);console.log(updatedUser),this.userService.update(updatedUser).subscribe(newUser=>{this.toastr.success(\"User updated\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"})},err=>{this.errors=err,this.isSubmitting=!1})}validation(values){const updatedUser={},entries=Object.entries(values);for(const[key,value]of entries)values[key]!==this.user[key]&&(updatedUser[key]=value,this.user[key]=value);return updatedUser}toggleModal(modalStatus=\"\"){this.modalStatus=modalStatus,this.modal.nativeElement.classList.toggle(\"show-modal\")}changePassword(oldPass,newPass){oldPass===newPass?this.toastr.error(\"Old and new password are the same\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}):\"\"===oldPass||\"\"===newPass?this.toastr.error(\"Fields cannot be empty\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}):this.userService.changePassword({oldPassword:oldPass,newPassword:newPass}).subscribe(updatedUser=>{updatedUser.invalidPassword?this.toastr.error(\"Current password is wrong\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}):(this.toggleModal(),this.toastr.success(\"User updated\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}))},err=>{this.errors=err,this.isSubmitting=!1})}removeAccount(pass){confirm(\"¿Seguro que deseas eliminar tu usuario? Una vez eliminado no habrá posibilidad de recuperarlo, así como tampoco podrás recuperar ninguno de los documentos creados con este usuario\")&&this.userService.removeAccount(pass).subscribe(data=>{data.invalidPassword?this.toastr.error(\"Contraseña incorrecta\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}):data.userRemoved&&(this.toastr.success(\"Usuario eliminado\",\"\",{positionClass:\"toast-bottom-right\",progressBar:!0,progressAnimation:\"decreasing\"}),this.logout())},err=>{this.errors=err,this.isSubmitting=!1})}logout(){this.userService.purgeAuth(),this.router.navigateByUrl(\"/\")}}return SettingsComponent.ɵfac=function(t){return new(t||SettingsComponent)(fesm2015_core.Lb(fesm2015_router.d),fesm2015_core.Lb(fesm2015_router.a),fesm2015_core.Lb(core.r),fesm2015_core.Lb(fesm2015_forms.f),fesm2015_core.Lb(ngx_toastr.b),fesm2015_core.Lb(core.d))},SettingsComponent.ɵcmp=fesm2015_core.Fb({type:SettingsComponent,selectors:[[\"app-settings\"]],viewQuery:function(rf,ctx){var _t;1&rf&&(fesm2015_core.Dc(_c0,!0),fesm2015_core.Dc(_c1,!0)),2&rf&&(fesm2015_core.oc(_t=fesm2015_core.ac())&&(ctx.modal=_t.first),fesm2015_core.oc(_t=fesm2015_core.ac())&&(ctx.imageSrc=_t.first))},decls:52,vars:9,consts:[[1,\"sub-menu\"],[1,\"sub-menu__container\"],[1,\"sub-menu__nav\",\"sub-menu__nav--my-forms\",2,\"justify-content\",\"center\"],[1,\"sub-menu__nav__button\",\"sub-menu__nav__button--without-hover\"],[1,\"settings\"],[3,\"errors\"],[1,\"settings__container\",3,\"formGroup\",\"ngSubmit\"],[1,\"settings__profile-image\"],[1,\"settings__profile-image__container\"],[1,\"settings__profile__image__img\"],[\"alt\",\"profile image\",3,\"src\"],[\"imageSrc\",\"\"],[1,\"settings__profile__image__input\"],[1,\"input-file\"],[\"type\",\"file\",\"name\",\"profile-image\",3,\"change\"],[1,\"settings__form\"],[1,\"settings__form__container\"],[1,\"settings__form__group\"],[\"type\",\"text\",\"placeholder\",\"Nombre de usuario\",\"formControlName\",\"username\"],[\"type\",\"text\",\"placeholder\",\"Nombre y apellidos\",\"formControlName\",\"nameAndSurname\"],[\"type\",\"text\",\"placeholder\",\"Corren electrónico\",\"formControlName\",\"email\"],[\"name\",\"description\",\"cols\",\"30\",\"rows\",\"10\",\"placeholder\",\"Description\",\"formControlName\",\"description\"],[\"type\",\"date\",\"placeholder\",\"Fecha de nacimiento\",\"formControlName\",\"dateOfBirth\"],[\"type\",\"text\",\"placeholder\",\"Empresa\",\"formControlName\",\"companyName\"],[\"type\",\"text\",\"placeholder\",\"Contacto\",\"formControlName\",\"contactInformation\"],[1,\"settings__form__button-container\"],[\"type\",\"submit\",1,\"button-filled\",\"icon\",\"icon-save-solid\"],[1,\"settings__buttons\"],[1,\"settings__buttons__container\"],[\"type\",\"button\",1,\"button-filled\",\"trigger\",3,\"click\"],[\"type\",\"button\",1,\"button-filled\",3,\"click\"],[1,\"modal\"],[\"modal\",\"\"],[1,\"modal__content\",2,\"padding\",\"2rem\"],[1,\"modal__content__modal-middle\",\"modal__content__modal-middle--change-password\"],[1,\"modal__content__modal-middle__container\"],[\"type\",\"password\",\"placeholder\",\"Contraseña actual\",3,\"ngModel\",\"ngModelChange\",4,\"ngIf\"],[\"type\",\"password\",\"placeholder\",\"Contraseña nueva\",3,\"ngModel\",\"ngModelChange\",4,\"ngIf\"],[\"type\",\"password\",\"placeholder\",\"Contraseña\",3,\"ngModel\",\"ngModelChange\",4,\"ngIf\"],[1,\"modal__content__modal-bottom\"],[\"class\",\"button-filled\",\"id\",\"modal-button\",3,\"click\",4,\"ngIf\"],[\"id\",\"modal-button\",1,\"button-filled\",3,\"click\"],[\"type\",\"password\",\"placeholder\",\"Contraseña actual\",3,\"ngModel\",\"ngModelChange\"],[\"type\",\"password\",\"placeholder\",\"Contraseña nueva\",3,\"ngModel\",\"ngModelChange\"],[\"type\",\"password\",\"placeholder\",\"Contraseña\",3,\"ngModel\",\"ngModelChange\"]],template:function(rf,ctx){1&rf&&(fesm2015_core.Qb(0,\"div\",0),fesm2015_core.Qb(1,\"div\",1),fesm2015_core.Qb(2,\"ul\",2),fesm2015_core.Qb(3,\"li\",3),fesm2015_core.zc(4),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Qb(5,\"div\",4),fesm2015_core.Mb(6,\"app-list-errors\",5),fesm2015_core.Qb(7,\"form\",6),fesm2015_core.Zb(\"ngSubmit\",(function(){return ctx.submitForm()})),fesm2015_core.Qb(8,\"div\",7),fesm2015_core.Qb(9,\"div\",8),fesm2015_core.Qb(10,\"div\",9),fesm2015_core.Mb(11,\"img\",10,11),fesm2015_core.Pb(),fesm2015_core.Qb(13,\"fieldset\",12),fesm2015_core.Qb(14,\"label\",13),fesm2015_core.zc(15,\" Cambiar imagen de perfil \"),fesm2015_core.Qb(16,\"input\",14),fesm2015_core.Zb(\"change\",(function($event){return ctx.onFileChange($event)})),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Qb(17,\"div\",15),fesm2015_core.Qb(18,\"div\",16),fesm2015_core.Qb(19,\"fieldset\",17),fesm2015_core.Mb(20,\"input\",18),fesm2015_core.Mb(21,\"input\",19),fesm2015_core.Mb(22,\"input\",20),fesm2015_core.Pb(),fesm2015_core.Qb(23,\"fieldset\",17),fesm2015_core.Mb(24,\"textarea\",21),fesm2015_core.Mb(25,\"input\",22),fesm2015_core.Mb(26,\"input\",23),fesm2015_core.Mb(27,\"input\",24),fesm2015_core.Pb(),fesm2015_core.Qb(28,\"div\",25),fesm2015_core.Mb(29,\"button\",26),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Mb(30,\"hr\"),fesm2015_core.Qb(31,\"div\",27),fesm2015_core.Qb(32,\"div\",28),fesm2015_core.Qb(33,\"button\",29),fesm2015_core.Zb(\"click\",(function(){return ctx.toggleModal(\"changePass\")})),fesm2015_core.zc(34,\" Cambiar contraseña \"),fesm2015_core.Pb(),fesm2015_core.Qb(35,\"button\",30),fesm2015_core.Zb(\"click\",(function(){return ctx.logout()})),fesm2015_core.zc(36,\" Cerrar sesión \"),fesm2015_core.Pb(),fesm2015_core.Qb(37,\"button\",30),fesm2015_core.Zb(\"click\",(function(){return ctx.toggleModal(\"remove\")})),fesm2015_core.zc(38,\" Eliminar cuenta \"),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Qb(39,\"div\",31,32),fesm2015_core.Qb(41,\"div\",33),fesm2015_core.Qb(42,\"div\",34),fesm2015_core.Qb(43,\"div\",35),fesm2015_core.yc(44,SettingsComponent_input_44_Template,1,1,\"input\",36),fesm2015_core.yc(45,SettingsComponent_input_45_Template,1,1,\"input\",37),fesm2015_core.yc(46,SettingsComponent_input_46_Template,1,1,\"input\",38),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Qb(47,\"div\",39),fesm2015_core.yc(48,SettingsComponent_button_48_Template,2,0,\"button\",40),fesm2015_core.yc(49,SettingsComponent_button_49_Template,2,0,\"button\",40),fesm2015_core.Qb(50,\"button\",41),fesm2015_core.Zb(\"click\",(function(){return ctx.toggleModal()})),fesm2015_core.zc(51,\"Cancelar\"),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb(),fesm2015_core.Pb()),2&rf&&(fesm2015_core.zb(4),fesm2015_core.Bc(\" \",ctx.user.username,\" \"),fesm2015_core.zb(2),fesm2015_core.ic(\"errors\",ctx.errors),fesm2015_core.zb(1),fesm2015_core.ic(\"formGroup\",ctx.settingsForm),fesm2015_core.zb(4),fesm2015_core.jc(\"src\",ctx.user.image,fesm2015_core.tc),fesm2015_core.zb(33),fesm2015_core.ic(\"ngIf\",\"changePass\"===ctx.modalStatus),fesm2015_core.zb(1),fesm2015_core.ic(\"ngIf\",\"changePass\"===ctx.modalStatus),fesm2015_core.zb(1),fesm2015_core.ic(\"ngIf\",\"remove\"===ctx.modalStatus),fesm2015_core.zb(2),fesm2015_core.ic(\"ngIf\",\"changePass\"===ctx.modalStatus),fesm2015_core.zb(1),fesm2015_core.ic(\"ngIf\",\"remove\"===ctx.modalStatus))},directives:[list_errors_component.a,fesm2015_forms.G,fesm2015_forms.r,fesm2015_forms.j,fesm2015_forms.c,fesm2015_forms.q,fesm2015_forms.i,common.t,fesm2015_forms.t],encapsulation:2}),SettingsComponent})();var of=__webpack_require__(\"LRne\");let settings_resolver_SettingsResolver=(()=>{class SettingsResolver{constructor(userService,router,commonsService){this.userService=userService,this.router=router,this.commonsService=commonsService}resolve(){if(this.commonsService.isBrowser()){if(this.userService.appInited)return this.userService.isAuth||this.router.navigateByUrl(\"/auth/login\"),Object(of.a)(!1);this.userService.populate(),this.userService.isAuthenticated.subscribe(isAuthenticated=>(isAuthenticated||this.router.navigateByUrl(\"/auth/login\"),Object(of.a)(!1)))}return Object(of.a)(!0)}}return SettingsResolver.ɵfac=function(t){return new(t||SettingsResolver)(fesm2015_core.Vb(core.r),fesm2015_core.Vb(fesm2015_router.d),fesm2015_core.Vb(core.d))},SettingsResolver.ɵprov=fesm2015_core.Hb({token:SettingsResolver,factory:SettingsResolver.ɵfac}),SettingsResolver})();const routes=[{path:\"\",component:settings_component_SettingsComponent,resolve:{initedInServer:settings_resolver_SettingsResolver}}];let settings_routing_module_SettingsRoutingModule=(()=>{class SettingsRoutingModule{}return SettingsRoutingModule.ɵmod=fesm2015_core.Jb({type:SettingsRoutingModule}),SettingsRoutingModule.ɵinj=fesm2015_core.Ib({factory:function(t){return new(t||SettingsRoutingModule)},imports:[[fesm2015_router.h.forChild(routes)],fesm2015_router.h]}),SettingsRoutingModule})(),settings_module_SettingsModule=(()=>{class SettingsModule{}return SettingsModule.ɵmod=fesm2015_core.Jb({type:SettingsModule}),SettingsModule.ɵinj=fesm2015_core.Ib({factory:function(t){return new(t||SettingsModule)},providers:[settings_resolver_SettingsResolver],imports:[[common.c,shared.a,settings_routing_module_SettingsRoutingModule]]}),SettingsModule})()}}]);","extractedComments":[]}